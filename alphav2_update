#!/bin/bash

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Animation function
function animate() {
    local pid=$1
    local delay=0.15
    local spinstr='|/-\'
    while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
        local temp=${spinstr#?}
        printf " [%c]  " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

# Header
function header() {
    clear
    echo -e "${BLUE}"
    echo "  _    _  ____  _   _  ____  "
    echo " | |  | |/ __ \| \ | |/ __ \ "
    echo " | |  | | |  | |  \| | |  | |"
    echo " | |  | | |  | | . \` | |  | |"
    echo " | |__| | |__| | |\  | |__| |"
    echo "  \____/ \____/|_| \_|\____/ "
    echo -e "${NC}"
    echo " ============================"
    echo "  VPN Installer (SSTP+PPTP+L2TP)"
    echo " ============================"
    echo ""
}

# Check if root
if [ "$(id -u)" != "0" ]; then
    header
    echo -e "${RED}Error: This script must be run as root!${NC}"
    echo -e "Please run with ${YELLOW}sudo${NC} or as ${YELLOW}root user${NC}"
    exit 1
fi

# Main installation
function install_vpn() {
    header
    echo -e "${GREEN}Starting VPN Installation...${NC}"
    echo ""
    
    # Install SSTP
    echo -e "${YELLOW}[1/3] Installing SSTP VPN...${NC}"
    (wget https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/debian-installer-sstp.sh -q && \
     chmod +x debian-installer-sstp.sh && \
     sudo ./debian-installer-sstp.sh) > /dev/null 2>&1 &
    animate $!
    echo -e "\n${GREEN}SSTP VPN installed successfully!${NC}"
    
    # Change directory
    echo -e "\n${YELLOW}[2/3] Changing to /usr/local/sbin...${NC}"
    (cd /usr/local/sbin) > /dev/null 2>&1 &
    animate $!
    echo -e "\n${GREEN}Directory changed successfully!${NC}"
    
    # Install VPN menu
    echo -e "\n${YELLOW}[3/3] Installing VPN Menu (SSTP+PPTP+L2TP)...${NC}"
    (rm -f vpn && \
     wget https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/vpn -q && \
     sudo chmod +x vpn) > /dev/null 2>&1 &
    animate $!
    echo -e "\n${GREEN}VPN Menu installed successfully!${NC}"
    
    # Completion message
    echo -e "\n${BLUE}==================================${NC}"
    echo -e "${GREEN}VPN Installation Completed Successfully!${NC}"
    echo -e "${BLUE}==================================${NC}"
    echo ""
    echo -e "You can now manage your VPN using the ${YELLOW}'vpn'${NC} command"
    echo -e "from ${YELLOW}/usr/local/sbin${NC} directory."
    echo ""
    echo -e "${BLUE}Thank you for using this installer!${NC}"
    echo ""
}

# Start installation
install_vpn
