#!/bin/bash
# My Telegram : https://t.me/hokagevpnpremium
# ==========================================
# Modern Color Scheme
RED='\033[1;31m'
NC='\033[0m'
GREEN='\033[1;32m'
ORANGE='\033[1;33m'
BLUE='\033[1;34m'
PURPLE='\033[1;35m'
CYAN='\033[1;36m'
LIGHT='\033[1;37m'
DARK='\033[1;30m'
# ==========================================

# Bot configuration
CHATID=$(grep -E "^#bot# " "/etc/bot/.bot.db" | cut -d ' ' -f 3)
KEY=$(grep -E "^#bot# " "/etc/bot/.bot.db" | cut -d ' ' -f 2)
export TIME="10"
export URL="https://api.telegram.org/bot$KEY/sendMessage"

# Function to display header
display_header() {
    clear
    echo -e "${PURPLE}"
    echo -e "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo -e "â•‘          ğŸ›¡ï¸ VPS RESTORE SYSTEM ğŸ›¡ï¸           â•‘"
    echo -e "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo -e "â•‘      Automated Restore from Backup File      â•‘"
    echo -e "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

# Function to send Telegram notification
notif_restore() {
    echo -e "${BLUE}ğŸ”¹ Sending Telegram notification...${NC}"
    TEXT="
<code>â—‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‡</code>
<b>  ğŸ”„ RESTORE NOTIFICATION ğŸ”„</b>
<b>     VPS Restore Details</b>
<code>â—‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‡</code>
<code>âœ… Restore Process Completed</code>
<code>â—‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‡</code>
<code>ğŸ¤– Bot : https://t.me/hokagevpnpremium</code>
"
    curl -s --max-time $TIME -d "chat_id=$CHATID&disable_web_page_preview=1&text=$TEXT&parse_mode=html" $URL >/dev/null
    echo -e "${GREEN}âœ” Telegram notification sent${NC}"
}

# Main restore process
display_header
echo -e "${GREEN}ğŸ”¹ Please enter the backup file link${NC}"
read -rp "ğŸ”— Backup URL: " -e url

echo -e "${BLUE}ğŸ”¹ Downloading backup file...${NC}"
wget -O backup.zip "$url" && echo -e "${GREEN}âœ” Backup downloaded successfully${NC}" || {
    echo -e "${RED}âŒ Failed to download backup file${NC}"
    exit 1
}

echo -e "${BLUE}ğŸ”¹ Extracting backup files...${NC}"
unzip -o backup.zip && echo -e "${GREEN}âœ” Backup extracted successfully${NC}" || {
    echo -e "${RED}âŒ Failed to extract backup file${NC}"
    exit 1
}

rm -f backup.zip
sleep 1

echo -e "${PURPLE}âš™ï¸ Starting restore process...${NC}"
cd /root/backup || {
    echo -e "${RED}âŒ Backup directory not found${NC}"
    exit 1
}

echo -e "${BLUE}ğŸ”¹ Restoring system files...${NC}"
cp passwd /etc/ && echo -e "${GREEN}âœ” /etc/passwd restored${NC}"
cp group /etc/ && echo -e "${GREEN}âœ” /etc/group restored${NC}"
cp shadow /etc/ && echo -e "${GREEN}âœ” /etc/shadow restored${NC}"
cp gshadow /etc/ && echo -e "${GREEN}âœ” /etc/gshadow restored${NC}"
cp crontab /etc/ && echo -e "${GREEN}âœ” /etc/crontab restored${NC}"

echo -e "${BLUE}ğŸ”¹ Restoring directories...${NC}"
cp -r kyt /var/lib/ && echo -e "${GREEN}âœ” /var/lib/kyt restored${NC}"
cp -r xray /etc/ && echo -e "${GREEN}âœ” /etc/xray restored${NC}"
cp -r html /var/www/ && echo -e "${GREEN}âœ” /var/www/html restored${NC}"

# Send notification
notif_restore

# Cleanup
echo -e "${BLUE}ğŸ”¹ Cleaning up temporary files...${NC}"
rm -rf /root/backup
rm -f backup.zip

# Final output
display_header
echo -e "${GREEN}"
echo -e "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo -e "â•‘             RESTORE COMPLETE                 â•‘"
echo -e "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo -e "â•‘  âœ… All files and configurations restored     â•‘"
echo -e "â•‘  âœ… System should be fully functional        â•‘"
echo -e "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"
echo -e "${GREEN}âœ” Restore process completed successfully${NC}"
echo -e "\n${ORANGE}Press Enter to continue...${NC}"
read -p ""
