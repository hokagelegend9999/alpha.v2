#!/bin/bash

# VPN Installer AlphaV2
# Eksekusi langsung tanpa pilihan menu

# Fungsi untuk tampilan header
show_header() {
    clear
    echo -e "\e[1;36m"
    echo "   ██╗   ██╗██████╗ ███╗   ██╗ █████╗ ██████╗ "
    echo "   ██║   ██║██╔══██╗████╗  ██║██╔══██╗██╔══██╗"
    echo "   ██║   ██║██████╔╝██╔██╗ ██║███████║██████╔╝"
    echo "   ██║   ██║██╔═══╝ ██║╚██╗██║██╔══██║██╔═══╝ "
    echo "   ╚██████╔╝██║     ██║ ╚████║██║  ██║██║     "
    echo -e "    ╚═════╝ ╚═╝     ╚═╝  ╚═══╝╚═╝  ╚═╝╚═╝     \e[0m"
    echo -e "\e[1;33m------------------------------------------\e[0m"
    echo -e "\e[1;32m       VPN INSTALLER - AUTO EXECUTION\e[0m"
    echo -e "\e[1;33m------------------------------------------\e[0m"
    echo
}

# Fungsi progress bar animasi
animated_progress() {
    echo -ne "\e[1;34m["
    while true; do
        for i in {1..20}; do
            echo -ne "▓"
            sleep 0.1
        done
        echo -ne "]\r["
        sleep 0.1
    done
}

# Fungsi utama
main() {
    show_header
    
    echo -e "\e[1;32mMemulai proses instalasi...\e[0m"
    echo
    
    # Animasi progress bar di background
    animated_progress &
    ANIM_PID=$!
    
    # 1. Install PPTP/L2TP/SSTP
    echo -e "\e[1;33m▶ Memulai instalasi PPTP/L2TP/SSTP...\e[0m"
    cd
    rm -f installer-sstp.sh
    wget -q https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/installer-sstp.sh
    chmod +x installer-sstp.sh
    sudo ./installer-sstp.sh
    rm -f installer-sstp.sh
    echo -e "\e[1;32m✔ PPTP/L2TP/SSTP berhasil diinstall\e[0m"
    echo
    
    # 2. Install Update
    echo -e "\e[1;33m▶ Memulai instalasi System Update...\e[0m"
    cd
    rm -f alpha2_update
    wget -q https://raw.githubusercontent.com/hokagelegend9999/update_alpha2/refs/heads/main/alpha2_update
    chmod +x alpha2_update
    ./alpha2_update
    rm -f alpha2_update
    echo -e "\e[1;32m✔ System Update berhasil diinstall\e[0m"
    echo
    
    # 3. Install Menu
    echo -e "\e[1;33m▶ Memulai instalasi VPN Menu...\e[0m"
    cd /usr/local/sbin
    rm -f vpn
    wget -q https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/vpn
    sudo chmod +x vpn
    cd
    echo -e "\e[1;32m✔ VPN Menu berhasil diinstall\e[0m"
    echo
    
    # Hentikan animasi progress bar
    kill $ANIM_PID
    wait $ANIM_PID 2>/dev/null
    
    echo -e "\e[1;36m------------------------------------------\e[0m"
    echo -e "\e[1;32m✔ Semua instalasi selesai!\e[0m"
    echo -e "\e[1;36m------------------------------------------\e[0m"
    
    # Self-cleanup
    echo -e "\n\e[1;33mMembersihkan file installer...\e[0m"
    sleep 2
    rm -f "$0"
    exit 0
}

# Jalankan fungsi utama
main
