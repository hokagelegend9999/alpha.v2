#!/bin/bash

# Title: Modern VPN Installer
# Version: 1.0
# Author: Your Name

# Check if Zenity is installed (for GUI)
if ! command -v zenity &> /dev/null; then
    sudo apt-get install -y zenity
fi

# Colors for terminal output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to display progress with animated loading
show_progress() {
    (
        echo "0" ; echo "# $1"
        sleep 1
        echo "25" ; echo "# $1 in progress..."
        sleep 1
        echo "50" ; echo "# $1 halfway done"
        sleep 1
        echo "75" ; echo "# $1 almost complete"
        sleep 1
        echo "100" ; echo "# $1 completed!"
    ) | zenity --progress \
      --title="Modern VPN Installer" \
      --text="Initializing..." \
      --percentage=0 \
      --auto-close \
      --width=400
}

# Function to install VPN protocols
install_vpn_protocols() {
    show_progress "Preparing VPN Protocols Installation"
    
    (
        echo "10" ; echo "# Removing old installer..."
        cd
        rm -f installer-sstp.sh
        echo "20" ; echo "# Downloading new installer..."
        wget -q https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/installer-sstp.sh
        echo "40" ; echo "# Setting permissions..."
        chmod +x installer-sstp.sh
        echo "60" ; echo "# Running installer..."
        sudo ./installer-sstp.sh
        echo "80" ; echo "# Cleaning up..."
        rm -f installer-sstp.sh
        echo "100" ; echo "# VPN Protocols installed successfully!"
    ) | zenity --progress \
      --title="Installing VPN Protocols" \
      --text="Installing PPTP/L2TP/SSTP..." \
      --percentage=0 \
      --auto-close \
      --width=400
    
    zenity --info --title="Success" --text="VPN Protocols (PPTP/L2TP/SSTP) installed successfully!" --width=300
}

# Function to install updates
install_updates() {
    show_progress "Preparing System Update"
    
    (
        echo "10" ; echo "# Removing old update script..."
        cd
        rm -f alpha2_update
        echo "30" ; echo "# Downloading new update script..."
        wget -q https://raw.githubusercontent.com/hokagelegend9999/update_alpha2/refs/heads/main/alpha2_update
        echo "50" ; echo "# Setting permissions..."
        chmod +x alpha2_update
        echo "70" ; echo "# Running updates..."
        ./alpha2_update
        echo "90" ; echo "# Cleaning up..."
        rm -f alpha2_update
        echo "100" ; echo "# System updated successfully!"
    ) | zenity --progress \
      --title="System Update" \
      --text="Updating system components..." \
      --percentage=0 \
      --auto-close \
      --width=400
    
    zenity --info --title="Success" --text="System updates installed successfully!" --width=300
}

# Function to install VPN menu
install_vpn_menu() {
    show_progress "Preparing VPN Menu Installation"
    
    (
        echo "20" ; echo "# Changing directory..."
        cd /usr/local/sbin
        echo "40" ; echo "# Removing old menu..."
        rm -f vpn
        echo "60" ; echo "# Downloading new menu..."
        wget -q https://raw.githubusercontent.com/hokagelegend9999/vpn/refs/heads/main/vpn
        echo "80" ; echo "# Setting permissions..."
        sudo chmod +x vpn
        echo "100" ; echo "# VPN Menu installed successfully!"
    ) | zenity --progress \
      --title="Installing VPN Menu" \
      --text="Setting up VPN management menu..." \
      --percentage=0 \
      --auto-close \
      --width=400
    
    zenity --info --title="Success" --text="VPN Menu installed successfully!" --width=300
}

# Main menu
while true; do
    choice=$(zenity --list \
        --title="Modern VPN Installer" \
        --text="Select an option:" \
        --width=500 --height=300 \
        --column="Option" --column="Description" \
        "1" "Install VPN Protocols (PPTP/L2TP/SSTP)" \
        "2" "Install System Updates" \
        "3" "Install VPN Menu" \
        "4" "Exit")
    
    case $choice in
        "1")
            install_vpn_protocols
            ;;
        "2")
            install_updates
            ;;
        "3")
            install_vpn_menu
            ;;
        "4")
            zenity --info --title="Goodbye" --text="Thank you for using Modern VPN Installer!" --width=300
            exit 0
            ;;
        *)
            exit 0
            ;;
    esac
done
